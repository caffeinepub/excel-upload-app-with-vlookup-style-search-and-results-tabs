{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Regular Expense tracking with budget, PDF reports, and desktop navigation wiring",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Ensure the desktop sidebar includes a visible History option that opens the existing History tab.",
      "acceptanceCriteria": [
        "On desktop (lg and up), the sidebar shows a \"History\" item.",
        "Clicking \"History\" opens the existing History tab content without errors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/layout/DesktopSidebarNav.tsx",
          "operation": "modify",
          "description": "Confirm the desktop sidebar primary navigation includes a persistent \"History\" item wired to the existing 'history' tab id, and that its label remains exactly \"History\" for visibility and clickability."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Add a desktop-only sidebar navigation item for Regular Expense that navigates to a new Regular Expense tab/page.",
      "acceptanceCriteria": [
        "On desktop (lg and up), the sidebar includes a \"Regular Expense\" item.",
        "Clicking \"Regular Expense\" navigates to a new tab/page that renders the expense tracking UI."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/layout/DesktopSidebarNav.tsx",
          "operation": "modify",
          "description": "Add a new primary menu item labeled \"Regular Expense\" (desktop sidebar only) wired to a new tab id (e.g., 'regular-expense') and choose an appropriate icon. Use shadcn-ui composed components already in the project; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Register/render a new TabsContent section for the 'regular-expense' tab id so sidebar navigation can display the new Regular Expense page without errors."
        },
        {
          "path": "frontend/src/pages/RegularExpenseTab.tsx",
          "operation": "create",
          "description": "Create the new Regular Expense tab/page component that will host budget management, expense entry, expense list, and PDF report download UI. Use shadcn-ui composed components already in the project; verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Add a desktop-only Regular Expense button on the Deskboard page that navigates to the Regular Expense tab/page.",
      "acceptanceCriteria": [
        "On desktop (lg and up), the Deskboard page shows a \"Regular Expense\" button.",
        "On mobile/tablet (< lg), the Deskboard \"Regular Expense\" button is not shown.",
        "Clicking the button navigates to the \"Regular Expense\" tab/page."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/DeskboardTab.tsx",
          "operation": "modify",
          "description": "Add a \"Regular Expense\" button that is only visible on lg+ breakpoints and calls onNavigate('regular-expense') when clicked. Use shadcn-ui composed components already in the project; verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Implement the Regular Expense page UI for authenticated users to set a budget and log daily expenses with date, type, and amount, showing login-required messaging when unauthenticated.",
      "acceptanceCriteria": [
        "The page includes a budget input (numeric) that can be saved for the logged-in user.",
        "The page includes an expense entry form with fields: Date, Type, Amount, and an \"Add\" action.",
        "After adding an expense, the new expense appears in a list/table on the same page.",
        "If the user is not logged in, the page shows an English message indicating login is required to manage expenses, and prevents submitting changes."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useRegularExpense.ts",
          "operation": "create",
          "description": "Add React Query hooks for Regular Expense data: fetch current user's budget, save/update budget, fetch current user's expenses, and add an expense; integrate with the existing useActor hook and invalidate relevant queries on success."
        },
        {
          "path": "frontend/src/pages/RegularExpenseTab.tsx",
          "operation": "modify",
          "description": "Implement the Regular Expense UI: (1) authentication gate using the existing Internet Identity state (show English login-required message and disable save/add actions when unauthenticated), (2) budget numeric input with Save action, (3) expense form fields Date/Type/Amount (+ optional description if desired) with Add action, and (4) an on-page list of expenses that updates after adding. Use shadcn-ui composed components already in the project; verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-6",
      "summary": "Add frontend PDF download for weekly/monthly/yearly expense reports with filenames and totals reflecting the selected range.",
      "acceptanceCriteria": [
        "The Regular Expense page provides a UI control to select: Weekly, Monthly, or Yearly report type.",
        "A \"Download PDF\" action generates a PDF using the selected report type.",
        "The PDF filename clearly indicates the selected range (weekly/monthly/yearly) and the covered dates.",
        "The PDF table includes at minimum: Date, Type, Amount, and includes totals appropriate to the selected range (e.g., total amount for the period)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/expenses/expenseReport.ts",
          "operation": "create",
          "description": "Create helper utilities to (1) compute weekly/monthly/yearly date ranges, (2) filter expense entries for the selected range, (3) compute totals, and (4) build export data (headers/rows) suitable for the existing exportToPdf utility."
        },
        {
          "path": "frontend/src/pages/RegularExpenseTab.tsx",
          "operation": "modify",
          "description": "Add report type selection (Weekly/Monthly/Yearly) and a \"Download PDF\" action that uses the existing frontend PDF export utility (frontend/src/lib/export/exportPdf.ts) to generate a report matching the selection; ensure the generated filename includes the report type and covered dates, and include a totals row/section. Use shadcn-ui composed components already in the project; verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}
{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-07T08:01:06.386Z",
  "summary": "Diff implements major parts of the attendance calendar UI, adds new attendance status (#companyLeave), introduces global holidays state + admin-gated CRUD methods, and adds frontend hooks/components for month calendar, per-date editor, and holiday management. However, several BuildRequest acceptance criteria are either not evidenced in the diff or are only partially implemented (notably holiday name/label, date-range holiday listing, and summary logic including global holidays).",
  "missing_requirements": [
    {
      "id": "REQ-2",
      "requirement": "Global holidays must include fields for date, name/label, and type (festival vs company leave).",
      "reason": "Backend HolidayEntry shown in the diff contains only { date; holidayType } and no name/label field; frontend HolidayManager UI also provides no name input/display.",
      "evidence": [
        "backend/main.mo",
        "frontend/src/components/attendance/HolidayManager.tsx"
      ]
    },
    {
      "id": "REQ-2",
      "requirement": "Backend exposes a query method to list global holidays within an inclusive date range (start YYYY-MM-DD, end YYYY-MM-DD).",
      "reason": "Frontend hook calls actor.getAllHolidays() (implying a non-range query), and the visible backend diff shows only create/update/delete holiday methods (range-list method is not evidenced).",
      "evidence": [
        "frontend/src/hooks/useHolidays.ts",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-6",
      "requirement": "Holiday management UI allows add/edit holiday name, date (YYYY-MM-DD), and type (Festival vs Company Leave).",
      "reason": "HolidayManager shows controls for date and type only; no name field is present in the shown UI code.",
      "evidence": [
        "frontend/src/components/attendance/HolidayManager.tsx"
      ]
    },
    {
      "id": "REQ-3",
      "requirement": "Attendance summary logic counts festival and company leave correctly over a date range, including counting global holidays even when the user has no stored AttendanceDayEntry for that date.",
      "reason": "Although AttendanceSummary type now includes festivalDays and companyLeaveDays, the diff excerpt does not show summary computation updated to incorporate globalHolidays (especially for days without stored user entries).",
      "evidence": [
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-1",
      "requirement": "Backend exposes methods to (a) fetch a single AttendanceDayEntry (or null) by arbitrary date, (b) upsert an AttendanceDayEntry by date, and (c) list attendance entries in an inclusive date range, all permission-checked like existing attendance methods.",
      "reason": "Frontend imports/uses hooks like useGetAttendanceEntry/useEditAttendanceEntry, but the backend diff excerpt does not show the new date-based query/upsert/range-list methods or their AccessControl checks; with truncated backend file, these are not verifiable from provided evidence.",
      "evidence": [
        "backend/main.mo",
        "frontend/src/pages/AttendanceTab.tsx",
        "frontend/src/hooks/useAttendance.ts"
      ]
    },
    {
      "id": "REQ-6",
      "requirement": "Holiday list supports viewing holidays for the currently viewed month and deleting an existing holiday date, sourced from a backend month/range query (not necessarily fetching all holidays globally).",
      "reason": "UI filters holidays client-side after fetching all holidays via getAllHolidays(); a month/range-based backend query is not evidenced.",
      "evidence": [
        "frontend/src/components/attendance/HolidayManager.tsx",
        "frontend/src/hooks/useHolidays.ts"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added a migration module and wired actor migration (with migration = Migration.run).",
      "reason": "BuildRequest did not request a data migration system explicitly (though it may be necessary to evolve stable state).",
      "evidence": [
        "backend/migration.mo",
        "backend/main.mo"
      ]
    },
    {
      "description": "Admin-check query method exposed to frontend via useIsCallerAdmin()/actor.isCallerAdmin().",
      "reason": "BuildRequest required holiday mutations be admin-only but did not explicitly require a dedicated isCallerAdmin API; this is an extra capability beyond the stated AC.",
      "evidence": [
        "frontend/src/hooks/useHolidays.ts"
      ]
    }
  ],
  "confidence": 0.68,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/attendance/AttendanceDateEditor.tsx",
    "frontend/src/components/attendance/AttendanceMonthCalendar.tsx",
    "frontend/src/components/attendance/HolidayManager.tsx",
    "frontend/src/hooks/useAttendance.ts",
    "frontend/src/hooks/useHolidays.ts",
    "frontend/src/pages/AttendanceTab.tsx",
    "project_state.json"
  ]
}
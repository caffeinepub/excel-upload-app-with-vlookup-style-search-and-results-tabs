{
  "kind": "build_request",
  "title": "Attendance month calendar with date-wise editing and global festival/company leave management",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add backend support for reading and editing attendance entries by arbitrary date (past and upcoming), not limited to the current day, so the frontend can fetch a specific date’s entry and update it.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "IN ATENDENCE ALSO ADD MONTH LIST IN WHICH WE CAN EDIT DATA DATE WISE PREVIOUS AND UPCOMING",
          "YES"
        ]
      },
      "acceptanceCriteria": [
        "Backend exposes a query method to fetch a single AttendanceDayEntry (or null) for a provided YYYY-MM-DD date for the authenticated caller.",
        "Backend exposes a shared method to upsert (create/update) an AttendanceDayEntry for a provided YYYY-MM-DD date for the authenticated caller, including status and optional check-in/check-out times.",
        "Backend exposes a query method to list attendance entries for the authenticated caller within an inclusive date range (start YYYY-MM-DD, end YYYY-MM-DD).",
        "All new methods enforce the same AccessControl permission checks used by existing attendance methods."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add backend support for global holidays that apply to all users, supporting at minimum two types: festival and company leave, and allow authorized users to create, update, list, and delete those holidays by date.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "ALSO SET FESTIVAL AND COMPANY LEAVE",
          "YES."
        ]
      },
      "acceptanceCriteria": [
        "Backend defines a persistent collection of global holidays keyed by date (YYYY-MM-DD) with fields sufficient to represent: date, name/label, and type (festival vs company leave).",
        "Backend exposes a query method to list global holidays within an inclusive date range.",
        "Backend exposes shared methods to upsert a global holiday and delete a global holiday by date.",
        "Global holiday mutation methods are permission-protected (admin-only or an equivalent privileged role using the existing AccessControl system)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update backend attendance summary logic so that festival and company leave days are counted correctly in summaries over a date range, including when those days come from global holidays.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "ALSO SET FESTIVAL AND COMPANY LEAVE",
          "YES."
        ]
      },
      "acceptanceCriteria": [
        "AttendanceSummary includes correct counts for festival days and company leave days for the requested range.",
        "Days that are global holidays are reflected in summary counts even if the user has no explicit AttendanceDayEntry stored for that date.",
        "Existing summary behavior for present/leave/half-day/weekly-off remains correct for stored user entries."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Implement an attendance calendar-style month view in the Attendance page where users can browse months (previous and upcoming), select a date, and view/edit attendance for that selected date.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "ADD MONTH LIST IN WHICH WE CAN EDIT DATA DATE WISE PREVIOUS AND UPCOMING",
          "calendar‑style month view where users can select any date to view or edit attendance"
        ]
      },
      "acceptanceCriteria": [
        "AttendanceTab provides a month view calendar UI with month navigation controls (at least previous/next month, and a clear month label).",
        "Selecting a date shows the stored attendance for that date (or an empty state if none) and allows editing for both past and upcoming dates.",
        "Edits persist via new backend methods and the UI refreshes to reflect the saved state without requiring a full page reload.",
        "The month view visually distinguishes: today, days with saved attendance entries, and days that are global holidays (festival/company leave)."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Add a date editor UI for attendance entries that allows changing status (present/leave/half-day/etc.) and managing times where applicable, with validation and clear user-facing error messages in English.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "EDIT DATA DATE WISE",
          "YES"
        ]
      },
      "acceptanceCriteria": [
        "For a selected date, the UI provides controls to update attendance status (including new statuses required to represent company leave distinctly from festival).",
        "If the user sets a status that implies no working hours (e.g., leave/festival/company leave), the UI makes it clear how working time will be treated (e.g., 0) and prevents inconsistent time inputs.",
        "Errors from backend mutations are shown as readable English messages (e.g., via existing toast/alert patterns).",
        "After saving, React Query caches for attendance data relevant to the calendar (selected date entry and month range view) are invalidated/refetched."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Add a global festival/company leave management UI so authorized users can set, edit, and delete holiday dates, and ensure those holidays appear automatically across the attendance month calendar for all users.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3",
          "msg-5"
        ],
        "quotes": [
          "ALSO SET FESTIVAL AND COMPANY LEAVE",
          "YES."
        ]
      },
      "acceptanceCriteria": [
        "Attendance UI includes a section (e.g., within Attendance settings) to manage global holidays: add/edit holiday name, date (YYYY-MM-DD via date picker), and type (Festival vs Company Leave).",
        "Holiday list supports viewing holidays for the currently viewed month and deleting an existing holiday date.",
        "If the current user is not authorized to manage holidays, the management controls are hidden or disabled with a clear English explanation.",
        "Calendar month view reflects global holidays (festival/company leave) without requiring users to manually create attendance entries for those dates."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; do not introduce additional backend services.",
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts or frontend/src/hooks/useActor.ts (immutable paths). Compose new hooks/components instead.",
    "Use English for all user-facing UI text."
  ],
  "nonGoals": [
    "Do not add third-party calendar integrations (Google Calendar, Outlook, etc.).",
    "Do not add real-time syncing or WebSocket-based updates.",
    "Do not introduce external databases or off-chain storage."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}
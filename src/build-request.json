{
  "kind": "build_request",
  "title": "Fix admin user approval/rejection failing with 'Invalid principal argument'",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-5",
      "text": "Fix the Admin Users approval/rejection flow so it passes a real Principal to the backend `setApproval` call (not a string cast to `any`), preventing the runtime error `Invalid principal argument: \"<principal>\"` when approving or rejecting users.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-11",
          "msg-12",
          "msg-13"
        ],
        "quotes": [
          "Invalid principal argument: \"guaqh-4pyji-naq27-ewgxq-n6a62-q2uqm-svesc-ojhzm-lj5k2-ht26q-aqe\"",
          "YES DURING USER AOOROVAL AND ALSO NOT REJECT",
          "FIX IT NOW"
        ]
      },
      "acceptanceCriteria": [
        "From `AdminUsersTab`, clicking Approve on a pending user updates that user to `Approved` without throwing an 'Invalid principal argument' error.",
        "From `AdminUsersTab`, clicking Reject on a pending/approved user updates that user to `Rejected` without throwing an 'Invalid principal argument' error.",
        "The frontend sends a `Principal` value (e.g., `approval.principal` or a `Principal.fromText(...)` result) to `useSetApproval().mutateAsync`, rather than `userPrincipal as any`."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Add frontend validation and user-facing error handling for approval actions: if a Principal cannot be parsed/constructed, block the mutation and show a clear error message in the Admin Users UI (English).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10",
          "msg-11",
          "msg-12"
        ],
        "quotes": [
          "I CANT APPROVE USERS",
          "Invalid principal argument: \"guaqh-4pyji-naq27-ewgxq-n6a62-q2uqm-svesc-ojhzm-lj5k2-ht26q-aqe\"",
          "YES DURING USER AOOROVAL AND ALSO NOT REJECT"
        ]
      },
      "acceptanceCriteria": [
        "If an invalid Principal string is ever encountered in the Admin Users page, the UI shows a descriptive error (e.g., 'Invalid Principal ID. Please refresh and try again.') and does not call the backend.",
        "Approval/rejection errors are displayed in the Admin Users page using a user-friendly message (not just console logs)."
      ]
    }
  ],
  "constraints": [
    "Use English for any user-facing text.",
    "Do not edit files under frontend/src/components/ui or any frontend immutablePaths listed in SYSTEM_CONTEXT.",
    "Keep backend in the single Motoko actor architecture; only add migration.mo changes if state migration is truly required (not expected for this fix)."
  ],
  "nonGoals": [
    "Implementing username/password authentication (the app currently uses Internet Identity).",
    "Adding new admin CRUD capabilities beyond fixing approve/reject.",
    "Changing backend authorization rules beyond what is required to support correct approve/reject calls."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}
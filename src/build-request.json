{
  "kind": "build_request",
  "title": "Add Regular Expense tracking with budget + PDF reports and ensure sidebar access",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Ensure the desktop sidebar navigation includes a visible, clickable \"History\" option that navigates to the existing History page/tab.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "ADD HISTORY OPTION IN BAR."
        ]
      },
      "acceptanceCriteria": [
        "On desktop (lg and up), the sidebar shows a \"History\" item.",
        "Clicking \"History\" opens the existing History tab content without errors."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add a new \"Regular Expense\" entry to the desktop sidebar navigation (desktop-only sidebar) that navigates to a new \"Regular Expense\" tab/page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "YES, ADD THAT BUTTON ALSO IN SIDE BAR"
        ]
      },
      "acceptanceCriteria": [
        "On desktop (lg and up), the sidebar includes a \"Regular Expense\" item.",
        "Clicking \"Regular Expense\" navigates to a new tab/page that renders the expense tracking UI."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add a desktop-only \"Regular Expense\" button on the Deskboard page that navigates to the \"Regular Expense\" tab/page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-5"
        ],
        "quotes": [
          "AND IN DESK TOP ADD REGULER EXPENCE BUTTON",
          "YES"
        ]
      },
      "acceptanceCriteria": [
        "On desktop (lg and up), the Deskboard page shows a \"Regular Expense\" button.",
        "On mobile/tablet (< lg), the Deskboard \"Regular Expense\" button is not shown.",
        "Clicking the button navigates to the \"Regular Expense\" tab/page."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Implement the \"Regular Expense\" page UI that lets an authenticated user (Internet Identity) set a budget and log expenses with date, expense type, amount, and a daily update workflow.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "ADD REGULER EXPENCE BUTTON IN WHICH WE CAN SET BUDGET AND DAILY UPDATE USE MONEY WITH DATE, TYPE OF EXPENXCE,AND AMOUNT"
        ]
      },
      "acceptanceCriteria": [
        "The page includes a budget input (numeric) that can be saved for the logged-in user.",
        "The page includes an expense entry form with fields: Date, Type, Amount, and an \"Add\" action.",
        "After adding an expense, the new expense appears in a list/table on the same page.",
        "If the user is not logged in, the page shows an English message indicating login is required to manage expenses, and prevents submitting changes."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Add backend persistence for per-user budgets and expense entries, including APIs to save/read the budget, create expense entries, and list expense entries for the caller (authorized users only).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "WE CAN SET BUDGET AND DAILY UPDATE USE MONEY WITH DATE, TYPE OF EXPENXCE,AND AMOUNT"
        ]
      },
      "acceptanceCriteria": [
        "Budget and expenses are stored per Principal and are returned only to the authorized caller.",
        "Backend exposes methods to: get current budget, set/update budget, add expense entry, list expense entries.",
        "Unauthorized callers (no #user permission) are rejected consistent with existing backend authorization behavior."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Add PDF download for expense reports where the user can choose report type (weekly, monthly, yearly), and the generated PDF content/format reflects the selected range.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-5"
        ],
        "quotes": [
          "WE CAN DOWNLOAD EXPENCE WEECKLY, MONTHLY, YEARLY EXPENCE REPORT IN PDF",
          "CAN CHOOSE REPORT TYPE AND DOWNLOAD - FORMAT ACCORDING TO THE CHOICE"
        ]
      },
      "acceptanceCriteria": [
        "The Regular Expense page provides a UI control to select: Weekly, Monthly, or Yearly report type.",
        "A \"Download PDF\" action generates a PDF using the selected report type.",
        "The PDF filename clearly indicates the selected range (weekly/monthly/yearly) and the covered dates.",
        "The PDF table includes at minimum: Date, Type, Amount, and includes totals appropriate to the selected range (e.g., total amount for the period)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; only add migration.mo if existing stable state requires it.",
    "Do not edit files under frontend/src/components/ui (compose existing shadcn components instead).",
    "Do not modify immutable frontend hook paths listed in SYSTEM_CONTEXT (e.g., frontend/src/hooks/useActor.ts, frontend/src/hooks/useInternetIdentity.ts/x).",
    "Use English for all user-facing text.",
    "Generate PDFs on the frontend using the existing PDF export utilities; do not generate PDFs in the backend."
  ],
  "nonGoals": [
    "Adding third-party authentication providers (only Internet Identity is supported).",
    "Real-time syncing via WebSockets/push notifications.",
    "Using external databases or non-Motoko backend services.",
    "Adding mobile-specific navigation for Regular Expense (unless required to make the desktop-only request work)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}